(function(t){var e=function(t,e){e(document).ready(function(){class s{constructor(t){this.$element=e(t),this.$tocList=this.$element.find(".toc-list"),this.$tocContent=this.$element.find(".toc-content"),this.$toggleButton=this.$element.find(".toc-toggle-button"),this.settings=this.getSettings(),this.headings=[],this.tocItems=[],this.init()}init(){this.bindEvents(),this.generateTOC(),this.handleInitialState(),this.handleResponsiveCollapse(),this.initScrollSpy()}getSettings(){const t=this.$element.find(".toc-custom-icon-template"),e=t.length>0?t.html():"";return{headingTypes:(this.$element.data("heading-types")||"h1,h2,h3,h4").split(","),containerSelector:this.$element.data("container-selector")||"",excludeClasses:this.$element.data("exclude-classes")||"",maxNestingLevel:parseInt(this.$element.data("max-nesting-level"))||3,listStyle:this.$element.hasClass("toc-style-custom")?"custom":"numbers",customIcon:e,enableCollapsible:this.$element.find(".toc-toggle-button").length>0,initiallyCollapsed:this.$element.hasClass("toc-collapsed")}}bindEvents(){this.$toggleButton.on("click",this.toggleTOC.bind(this)),this.$toggleButton.on("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.toggleTOC())}),this.$element.on("click",'.toc-list a[href^="#"]',this.handleSmoothScroll.bind(this)),e(window).on("resize",this.debounce(this.handleResponsiveCollapse.bind(this),250)),e(window).on("scroll",this.throttle(this.updateActiveHeading.bind(this),100))}generateTOC(){this.$element.addClass("toc-loading");const t=this.getContainer();if(this.findHeadings(t),this.headings.length>0){const t=this.buildTOCHTML();this.$tocList.html(t),this.$element.removeClass("toc-empty")}else this.$element.addClass("toc-empty");this.$element.removeClass("toc-loading")}getContainer(){if(this.settings.containerSelector){const t=e(this.settings.containerSelector);if(t.length>0)return t.first()}const t=[".entry-content",".post-content",".page-content","main","article","body"];for(let s of t){const t=e(s);if(t.length>0)return t.first()}return e(document)}findHeadings(t){const s=this.settings.headingTypes.join(","),n=this.settings.excludeClasses.split(",").map(t=>t.trim()).filter(t=>t);this.headings=[],t.find(s).each((t,s)=>{const i=e(s);if(n.length>0){const t=n.some(t=>i.hasClass(t));if(t)return}const l=i.text().trim();if(!l)return;let a=i.attr("id");a||(a=this.generateHeadingId(l,t),i.attr("id",a));const o=s.tagName.toLowerCase(),h=parseInt(o.substring(1));this.headings.push({id:a,text:l,level:h,element:i[0]})})}generateHeadingId(t,e){let s=t.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/--+/g,"-").replace(/^-|-$/g,""),n=s||"heading-"+(e+1),i=1;for(;document.getElementById(n);)n=s+"-"+i,i++;return n}buildTOCHTML(){if(0===this.headings.length)return"";const t=this.buildTOCTree();return this.renderTOCTree(t,1)}buildTOCTree(){const t=[],e=[];return this.headings.forEach((s,n)=>{const i={...s,number:"",children:[]};for(;e.length>0&&e[e.length-1].level>=s.level;)e.pop();if(0===e.length)t.push(i);else{const n=e[e.length-1];n.level<s.level&&n.children.length<100?n.children.push(i):t.push(i)}e.push(i)}),this.generateNumbers(t,[]),t}generateNumbers(t,e){t.forEach((t,s)=>{const n=[...e,s+1];"numbers"===this.settings.listStyle&&(t.number=n.join(".")),t.children.length>0&&n.length<this.settings.maxNestingLevel&&this.generateNumbers(t.children,n)})}renderTOCTree(t,e){if(0===t.length||e>this.settings.maxNestingLevel)return"";let s="<ul>";return t.forEach(t=>{let n="";"numbers"===this.settings.listStyle?n=this.escapeHtml(t.number):"custom"===this.settings.listStyle&&this.settings.customIcon&&(n=this.settings.customIcon),s+="<li>",s+=`<span class="toc-marker">${n}</span>`,s+=`<a href="#${this.escapeHtml(t.id)}" data-heading-id="${this.escapeHtml(t.id)}">`,s+=this.escapeHtml(t.text),s+="</a>",t.children.length>0&&e<this.settings.maxNestingLevel&&(s+=this.renderTOCTree(t.children,e+1)),s+="</li>"}),s+="</ul>",s}handleInitialState(){if(!this.settings.enableCollapsible)return;const t=this.settings.initiallyCollapsed||this.shouldAutoCollapse();t?(this.$element.addClass("toc-collapsed").removeClass("toc-expanded"),this.$toggleButton.attr("aria-expanded","false")):(this.$element.removeClass("toc-collapsed").addClass("toc-expanded"),this.$toggleButton.attr("aria-expanded","true"))}shouldAutoCollapse(){const t=e(window).width();return!!(this.$element.hasClass("toc-collapsible-tablet")&&t<=1024)}handleResponsiveCollapse(){if(this.settings.enableCollapsible&&this.$element.hasClass("toc-collapsible-tablet")){const t=e(window).width();t<=1024?this.$element.hasClass("toc-collapsed")||this.$element.hasClass("toc-expanded")||(this.$element.addClass("toc-collapsed"),this.$toggleButton.attr("aria-expanded","false")):(this.$element.removeClass("toc-collapsed").addClass("toc-expanded"),this.$toggleButton.attr("aria-expanded","true"))}}toggleTOC(){const t=this.$element.hasClass("toc-collapsed");t?(this.$element.removeClass("toc-collapsed").addClass("toc-expanded"),this.$toggleButton.attr("aria-expanded","true")):(this.$element.addClass("toc-collapsed").removeClass("toc-expanded"),this.$toggleButton.attr("aria-expanded","false"))}handleSmoothScroll(t){const s=e(t.currentTarget),n=s.attr("href").substring(1);this.setActiveHeading(n)}initScrollSpy(){this.updateActiveHeading()}updateActiveHeading(){if(0===this.headings.length)return;const t=e(window).scrollTop();let s=50;e("#wpadminbar").length>0&&(s+=e("#wpadminbar").outerHeight()||32);let n=null;for(let i=this.headings.length-1;i>=0;i--){const l=this.headings[i],a=e(l.element);if(a.length>0){const e=a.offset().top;if(t+s>=e){n=l.id;break}}}this.setActiveHeading(n)}setActiveHeading(t){this.$tocList.find("a").removeClass("toc-active"),t&&this.$tocList.find(`a[data-heading-id="${t}"]`).addClass("toc-active")}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}debounce(t,e){let s;return function(...n){const i=()=>{clearTimeout(s),t(...n)};clearTimeout(s),s=setTimeout(i,e)}}throttle(t,e){let s;return function(...n){s||(t.apply(this,n),s=!0,setTimeout(()=>s=!1,e))}}}t.find(".athemes-addons-table-of-contents").each(function(){e(this).data("toc-initialized")||(new s(this),e(this).data("toc-initialized",!0))})})};t(window).on("elementor/frontend/init",function(){elementorFrontend.hooks.addAction("frontend/element_ready/athemes-addons-table-of-contents.default",e)})})(jQuery);